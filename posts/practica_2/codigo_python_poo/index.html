<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Práctica 2: Programación Orientada a Objetos | PortafolioPP2025</title><meta name=keywords content><meta name=description content='Codigo Migrado en python(POO)
Guarda este archivo en la raíz del proyecto o en una carpeta biblioteca_python/. Es autocontenido y usa JSON (data.json) para persistencia.
#!/usr/bin/env python3
# biblioteca_poo.py
# Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON
# Requisitos: Python 3.7+

import json
from datetime import datetime
from typing import List, Dict, Optional
from abc import ABC, abstractmethod
import os

DATA_FILE = "biblioteca_data.json"

# -------------------------
# Modelos (POO)
# -------------------------

class Item(ABC):
    """Clase abstracta para ítems de la biblioteca."""
    def __init__(self, item_id: str, title: str, year: int):
        self._id = item_id            # encapsulado (protected)
        self.title = title
        self.year = year
        self.available = True
        self.borrower_id: Optional[str] = None
        self.borrow_date: Optional[str] = None

    @property
    def id(self):
        return self._id

    @abstractmethod
    def item_type(self) -> str:
        pass

    def to_dict(self) -> Dict:
        return {
            "id": self._id,
            "title": self.title,
            "year": self.year,
            "type": self.item_type(),
            "available": self.available,
            "borrower_id": self.borrower_id,
            "borrow_date": self.borrow_date
        }

    def borrow(self, user_id: str) -> bool:
        if not self.available:
            return False
        self.available = False
        self.borrower_id = user_id
        self.borrow_date = datetime.utcnow().isoformat()
        return True

    def give_back(self) -> bool:
        if self.available:
            return False
        self.available = True
        self.borrower_id = None
        self.borrow_date = None
        return True

class Book(Item):
    def __init__(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] = None):
        super().__init__(item_id, title, year)
        self.author = author
        self.isbn = isbn

    def item_type(self) -> str:
        return "book"

    def to_dict(self) -> Dict:
        d = super().to_dict()
        d.update({"author": self.author, "isbn": self.isbn})
        return d

class Magazine(Item):
    def __init__(self, item_id: str, title: str, issue: str, year: int):
        super().__init__(item_id, title, year)
        self.issue = issue

    def item_type(self) -> str:
        return "magazine"

    def to_dict(self) -> Dict:
        d = super().to_dict()
        d.update({"issue": self.issue})
        return d

class User:
    def __init__(self, user_id: str, name: str, email: Optional[str] = None):
        self._id = user_id     # encapsulación
        self.name = name
        self.email = email
        self.borrowed_items: List[str] = []  # lista de ids

    @property
    def id(self):
        return self._id

    def to_dict(self) -> Dict:
        return {
            "id": self._id,
            "name": self.name,
            "email": self.email,
            "borrowed_items": self.borrowed_items
        }

# -------------------------
# Biblioteca (gestor)
# -------------------------

class Library:
    def __init__(self):
        self.items: Dict[str, Item] = {}
        self.users: Dict[str, User] = {}
        self.load()

    # --- CRUD / operaciones ---
    def add_user(self, user: User) -> None:
        if user.id in self.users:
            raise ValueError("Usuario ya existe")
        self.users[user.id] = user
        self.save()

    def add_item(self, item: Item) -> None:
        if item.id in self.items:
            raise ValueError("Ítem ya existe")
        self.items[item.id] = item
        self.save()

    def find_items(self, query: str) -> List[Item]:
        q = query.lower()
        results = []
        for it in self.items.values():
            if q in it.title.lower() or q in it.item_type().lower():
                results.append(it)
            else:
                # campos específicos
                if isinstance(it, Book) and (q in it.author.lower() if it.author else False):
                    results.append(it)
        return results

    def find_users(self, query: str) -> List[User]:
        q = query.lower()
        return [u for u in self.users.values() if q in u.name.lower() or q in (u.email or "").lower() or q == u.id.lower()]

    def borrow_item(self, item_id: str, user_id: str) -> bool:
        if item_id not in self.items:
            raise ValueError("Ítem no encontrado")
        if user_id not in self.users:
            raise ValueError("Usuario no encontrado")
        item = self.items[item_id]
        user = self.users[user_id]
        if not item.available:
            return False
        ok = item.borrow(user_id)
        if ok:
            user.borrowed_items.append(item_id)
            self.save()
        return ok

    def return_item(self, item_id: str, user_id: str) -> bool:
        if item_id not in self.items:
            raise ValueError("Ítem no encontrado")
        if user_id not in self.users:
            raise ValueError("Usuario no encontrado")
        item = self.items[item_id]
        user = self.users[user_id]
        if item.available or item.borrower_id != user_id:
            return False
        ok = item.give_back()
        if ok:
            if item_id in user.borrowed_items:
                user.borrowed_items.remove(item_id)
            self.save()
        return ok

    # --- persistencia ---
    def save(self) -> None:
        payload = {
            "items": {iid: it.to_dict() for iid, it in self.items.items()},
            "users": {uid: u.to_dict() for uid, u in self.users.items()}
        }
        with open(DATA_FILE, "w", encoding="utf-8") as f:
            json.dump(payload, f, indent=2, ensure_ascii=False)

    def load(self) -> None:
        if not os.path.exists(DATA_FILE):
            return
        with open(DATA_FILE, "r", encoding="utf-8") as f:
            payload = json.load(f)
        # Cargar users
        self.users = {}
        for uid, ud in payload.get("users", {}).items():
            u = User(uid, ud.get("name", ""), ud.get("email"))
            u.borrowed_items = ud.get("borrowed_items", [])
            self.users[uid] = u
        # Cargar items (reconstruir tipo concreto)
        self.items = {}
        for iid, idata in payload.get("items", {}).items():
            t = idata.get("type")
            if t == "book":
                it = Book(iid, idata.get("title", ""), idata.get("author", ""), idata.get("year", 0), idata.get("isbn"))
            elif t == "magazine":
                it = Magazine(iid, idata.get("title", ""), idata.get("issue", ""), idata.get("year", 0))
            else:
                # genérico fallback
                class GenericItem(Item):
                    def item_type(self): return "generic"
                it = GenericItem(iid, idata.get("title", ""), idata.get("year", 0))
            it.available = idata.get("available", True)
            it.borrower_id = idata.get("borrower_id")
            it.borrow_date = idata.get("borrow_date")
            self.items[iid] = it

    # Utility
    def list_items(self) -> List[Dict]:
        return [it.to_dict() for it in self.items.values()]

    def list_users(self) -> List[Dict]:
        return [u.to_dict() for u in self.users.values()]

# -------------------------
# Interfaz de consola (menú)
# -------------------------

def input_nonempty(prompt: str) -> str:
    while True:
        v = input(prompt).strip()
        if v:
            return v

def main_menu(lib: Library):
    while True:
        print("\n=== Biblioteca POO ===")
        print("1) Registrar usuario")
        print("2) Registrar ítem (libro/revista)")
        print("3) Buscar ítems")
        print("4) Buscar usuarios")
        print("5) Prestar ítem")
        print("6) Devolver ítem")
        print("7) Listar ítems")
        print("8) Listar usuarios")
        print("9) Salir")
        choice = input("Opción: ").strip()
        try:
            if choice == "1":
                uid = input_nonempty("ID usuario: ")
                name = input_nonempty("Nombre: ")
                email = input("Email (opcional): ").strip() or None
                lib.add_user(User(uid, name, email))
                print("Usuario registrado.")
            elif choice == "2":
                itype = input("Tipo (book/magazine): ").strip().lower()
                iid = input_nonempty("ID ítem: ")
                title = input_nonempty("Título: ")
                year = int(input("Año: ").strip() or 0)
                if itype == "book":
                    author = input_nonempty("Autor: ")
                    isbn = input("ISBN (opcional): ").strip() or None
                    lib.add_item(Book(iid, title, author, year, isbn))
                else:
                    issue = input("Número/Edición: ").strip() or "n/a"
                    lib.add_item(Magazine(iid, title, issue, year))
                print("Ítem registrado.")
            elif choice == "3":
                q = input_nonempty("Buscar (título/autor/tipo): ")
                res = lib.find_items(q)
                if not res:
                    print("No hay resultados.")
                else:
                    for it in res:
                        print(json.dumps(it.to_dict(), ensure_ascii=False, indent=2))
            elif choice == "4":
                q = input_nonempty("Buscar usuario (nombre/id/email): ")
                res = lib.find_users(q)
                if not res:
                    print("No hay resultados.")
                else:
                    for u in res:
                        print(json.dumps(u.to_dict(), ensure_ascii=False, indent=2))
            elif choice == "5":
                iid = input_nonempty("ID ítem a prestar: ")
                uid = input_nonempty("ID usuario: ")
                ok = lib.borrow_item(iid, uid)
                if ok:
                    print("Préstamo realizado.")
                else:
                    print("No fue posible prestar (puede que no esté disponible).")
            elif choice == "6":
                iid = input_nonempty("ID ítem a devolver: ")
                uid = input_nonempty("ID usuario que devuelve: ")
                ok = lib.return_item(iid, uid)
                if ok:
                    print("Devolución registrada.")
                else:
                    print("No se pudo procesar la devolución.")
            elif choice == "7":
                for it in lib.list_items():
                    print(json.dumps(it, ensure_ascii=False, indent=2))
            elif choice == "8":
                for u in lib.list_users():
                    print(json.dumps(u, ensure_ascii=False, indent=2))
            elif choice == "9":
                print("Saliendo.")
                break
            else:
                print("Opción inválida.")
        except Exception as e:
            print("Error:", e)

if __name__ == "__main__":
    library = Library()
    print("Datos cargados. Ítems:", len(library.items), " Usuarios:", len(library.users))
    main_menu(library)
Qué hace (resumen):'><meta name=author content><link rel=canonical href=https://gaelflores.github.io/posts/practica_2/codigo_python_poo/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://gaelflores.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gaelflores.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gaelflores.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://gaelflores.github.io/apple-touch-icon.png><link rel=mask-icon href=https://gaelflores.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gaelflores.github.io/posts/practica_2/codigo_python_poo/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://gaelflores.github.io/posts/practica_2/codigo_python_poo/"><meta property="og:site_name" content="PortafolioPP2025"><meta property="og:title" content="Práctica 2: Programación Orientada a Objetos"><meta property="og:description" content='Codigo Migrado en python(POO) Guarda este archivo en la raíz del proyecto o en una carpeta biblioteca_python/. Es autocontenido y usa JSON (data.json) para persistencia.
#!/usr/bin/env python3 # biblioteca_poo.py # Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON # Requisitos: Python 3.7+ import json from datetime import datetime from typing import List, Dict, Optional from abc import ABC, abstractmethod import os DATA_FILE = "biblioteca_data.json" # ------------------------- # Modelos (POO) # ------------------------- class Item(ABC): """Clase abstracta para ítems de la biblioteca.""" def __init__(self, item_id: str, title: str, year: int): self._id = item_id # encapsulado (protected) self.title = title self.year = year self.available = True self.borrower_id: Optional[str] = None self.borrow_date: Optional[str] = None @property def id(self): return self._id @abstractmethod def item_type(self) -> str: pass def to_dict(self) -> Dict: return { "id": self._id, "title": self.title, "year": self.year, "type": self.item_type(), "available": self.available, "borrower_id": self.borrower_id, "borrow_date": self.borrow_date } def borrow(self, user_id: str) -> bool: if not self.available: return False self.available = False self.borrower_id = user_id self.borrow_date = datetime.utcnow().isoformat() return True def give_back(self) -> bool: if self.available: return False self.available = True self.borrower_id = None self.borrow_date = None return True class Book(Item): def __init__(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] = None): super().__init__(item_id, title, year) self.author = author self.isbn = isbn def item_type(self) -> str: return "book" def to_dict(self) -> Dict: d = super().to_dict() d.update({"author": self.author, "isbn": self.isbn}) return d class Magazine(Item): def __init__(self, item_id: str, title: str, issue: str, year: int): super().__init__(item_id, title, year) self.issue = issue def item_type(self) -> str: return "magazine" def to_dict(self) -> Dict: d = super().to_dict() d.update({"issue": self.issue}) return d class User: def __init__(self, user_id: str, name: str, email: Optional[str] = None): self._id = user_id # encapsulación self.name = name self.email = email self.borrowed_items: List[str] = [] # lista de ids @property def id(self): return self._id def to_dict(self) -> Dict: return { "id": self._id, "name": self.name, "email": self.email, "borrowed_items": self.borrowed_items } # ------------------------- # Biblioteca (gestor) # ------------------------- class Library: def __init__(self): self.items: Dict[str, Item] = {} self.users: Dict[str, User] = {} self.load() # --- CRUD / operaciones --- def add_user(self, user: User) -> None: if user.id in self.users: raise ValueError("Usuario ya existe") self.users[user.id] = user self.save() def add_item(self, item: Item) -> None: if item.id in self.items: raise ValueError("Ítem ya existe") self.items[item.id] = item self.save() def find_items(self, query: str) -> List[Item]: q = query.lower() results = [] for it in self.items.values(): if q in it.title.lower() or q in it.item_type().lower(): results.append(it) else: # campos específicos if isinstance(it, Book) and (q in it.author.lower() if it.author else False): results.append(it) return results def find_users(self, query: str) -> List[User]: q = query.lower() return [u for u in self.users.values() if q in u.name.lower() or q in (u.email or "").lower() or q == u.id.lower()] def borrow_item(self, item_id: str, user_id: str) -> bool: if item_id not in self.items: raise ValueError("Ítem no encontrado") if user_id not in self.users: raise ValueError("Usuario no encontrado") item = self.items[item_id] user = self.users[user_id] if not item.available: return False ok = item.borrow(user_id) if ok: user.borrowed_items.append(item_id) self.save() return ok def return_item(self, item_id: str, user_id: str) -> bool: if item_id not in self.items: raise ValueError("Ítem no encontrado") if user_id not in self.users: raise ValueError("Usuario no encontrado") item = self.items[item_id] user = self.users[user_id] if item.available or item.borrower_id != user_id: return False ok = item.give_back() if ok: if item_id in user.borrowed_items: user.borrowed_items.remove(item_id) self.save() return ok # --- persistencia --- def save(self) -> None: payload = { "items": {iid: it.to_dict() for iid, it in self.items.items()}, "users": {uid: u.to_dict() for uid, u in self.users.items()} } with open(DATA_FILE, "w", encoding="utf-8") as f: json.dump(payload, f, indent=2, ensure_ascii=False) def load(self) -> None: if not os.path.exists(DATA_FILE): return with open(DATA_FILE, "r", encoding="utf-8") as f: payload = json.load(f) # Cargar users self.users = {} for uid, ud in payload.get("users", {}).items(): u = User(uid, ud.get("name", ""), ud.get("email")) u.borrowed_items = ud.get("borrowed_items", []) self.users[uid] = u # Cargar items (reconstruir tipo concreto) self.items = {} for iid, idata in payload.get("items", {}).items(): t = idata.get("type") if t == "book": it = Book(iid, idata.get("title", ""), idata.get("author", ""), idata.get("year", 0), idata.get("isbn")) elif t == "magazine": it = Magazine(iid, idata.get("title", ""), idata.get("issue", ""), idata.get("year", 0)) else: # genérico fallback class GenericItem(Item): def item_type(self): return "generic" it = GenericItem(iid, idata.get("title", ""), idata.get("year", 0)) it.available = idata.get("available", True) it.borrower_id = idata.get("borrower_id") it.borrow_date = idata.get("borrow_date") self.items[iid] = it # Utility def list_items(self) -> List[Dict]: return [it.to_dict() for it in self.items.values()] def list_users(self) -> List[Dict]: return [u.to_dict() for u in self.users.values()] # ------------------------- # Interfaz de consola (menú) # ------------------------- def input_nonempty(prompt: str) -> str: while True: v = input(prompt).strip() if v: return v def main_menu(lib: Library): while True: print("\n=== Biblioteca POO ===") print("1) Registrar usuario") print("2) Registrar ítem (libro/revista)") print("3) Buscar ítems") print("4) Buscar usuarios") print("5) Prestar ítem") print("6) Devolver ítem") print("7) Listar ítems") print("8) Listar usuarios") print("9) Salir") choice = input("Opción: ").strip() try: if choice == "1": uid = input_nonempty("ID usuario: ") name = input_nonempty("Nombre: ") email = input("Email (opcional): ").strip() or None lib.add_user(User(uid, name, email)) print("Usuario registrado.") elif choice == "2": itype = input("Tipo (book/magazine): ").strip().lower() iid = input_nonempty("ID ítem: ") title = input_nonempty("Título: ") year = int(input("Año: ").strip() or 0) if itype == "book": author = input_nonempty("Autor: ") isbn = input("ISBN (opcional): ").strip() or None lib.add_item(Book(iid, title, author, year, isbn)) else: issue = input("Número/Edición: ").strip() or "n/a" lib.add_item(Magazine(iid, title, issue, year)) print("Ítem registrado.") elif choice == "3": q = input_nonempty("Buscar (título/autor/tipo): ") res = lib.find_items(q) if not res: print("No hay resultados.") else: for it in res: print(json.dumps(it.to_dict(), ensure_ascii=False, indent=2)) elif choice == "4": q = input_nonempty("Buscar usuario (nombre/id/email): ") res = lib.find_users(q) if not res: print("No hay resultados.") else: for u in res: print(json.dumps(u.to_dict(), ensure_ascii=False, indent=2)) elif choice == "5": iid = input_nonempty("ID ítem a prestar: ") uid = input_nonempty("ID usuario: ") ok = lib.borrow_item(iid, uid) if ok: print("Préstamo realizado.") else: print("No fue posible prestar (puede que no esté disponible).") elif choice == "6": iid = input_nonempty("ID ítem a devolver: ") uid = input_nonempty("ID usuario que devuelve: ") ok = lib.return_item(iid, uid) if ok: print("Devolución registrada.") else: print("No se pudo procesar la devolución.") elif choice == "7": for it in lib.list_items(): print(json.dumps(it, ensure_ascii=False, indent=2)) elif choice == "8": for u in lib.list_users(): print(json.dumps(u, ensure_ascii=False, indent=2)) elif choice == "9": print("Saliendo.") break else: print("Opción inválida.") except Exception as e: print("Error:", e) if __name__ == "__main__": library = Library() print("Datos cargados. Ítems:", len(library.items), " Usuarios:", len(library.users)) main_menu(library) Qué hace (resumen):'><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-14T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-14T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Práctica 2: Programación Orientada a Objetos"><meta name=twitter:description content='Codigo Migrado en python(POO)
Guarda este archivo en la raíz del proyecto o en una carpeta biblioteca_python/. Es autocontenido y usa JSON (data.json) para persistencia.
#!/usr/bin/env python3
# biblioteca_poo.py
# Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON
# Requisitos: Python 3.7+

import json
from datetime import datetime
from typing import List, Dict, Optional
from abc import ABC, abstractmethod
import os

DATA_FILE = "biblioteca_data.json"

# -------------------------
# Modelos (POO)
# -------------------------

class Item(ABC):
    """Clase abstracta para ítems de la biblioteca."""
    def __init__(self, item_id: str, title: str, year: int):
        self._id = item_id            # encapsulado (protected)
        self.title = title
        self.year = year
        self.available = True
        self.borrower_id: Optional[str] = None
        self.borrow_date: Optional[str] = None

    @property
    def id(self):
        return self._id

    @abstractmethod
    def item_type(self) -> str:
        pass

    def to_dict(self) -> Dict:
        return {
            "id": self._id,
            "title": self.title,
            "year": self.year,
            "type": self.item_type(),
            "available": self.available,
            "borrower_id": self.borrower_id,
            "borrow_date": self.borrow_date
        }

    def borrow(self, user_id: str) -> bool:
        if not self.available:
            return False
        self.available = False
        self.borrower_id = user_id
        self.borrow_date = datetime.utcnow().isoformat()
        return True

    def give_back(self) -> bool:
        if self.available:
            return False
        self.available = True
        self.borrower_id = None
        self.borrow_date = None
        return True

class Book(Item):
    def __init__(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] = None):
        super().__init__(item_id, title, year)
        self.author = author
        self.isbn = isbn

    def item_type(self) -> str:
        return "book"

    def to_dict(self) -> Dict:
        d = super().to_dict()
        d.update({"author": self.author, "isbn": self.isbn})
        return d

class Magazine(Item):
    def __init__(self, item_id: str, title: str, issue: str, year: int):
        super().__init__(item_id, title, year)
        self.issue = issue

    def item_type(self) -> str:
        return "magazine"

    def to_dict(self) -> Dict:
        d = super().to_dict()
        d.update({"issue": self.issue})
        return d

class User:
    def __init__(self, user_id: str, name: str, email: Optional[str] = None):
        self._id = user_id     # encapsulación
        self.name = name
        self.email = email
        self.borrowed_items: List[str] = []  # lista de ids

    @property
    def id(self):
        return self._id

    def to_dict(self) -> Dict:
        return {
            "id": self._id,
            "name": self.name,
            "email": self.email,
            "borrowed_items": self.borrowed_items
        }

# -------------------------
# Biblioteca (gestor)
# -------------------------

class Library:
    def __init__(self):
        self.items: Dict[str, Item] = {}
        self.users: Dict[str, User] = {}
        self.load()

    # --- CRUD / operaciones ---
    def add_user(self, user: User) -> None:
        if user.id in self.users:
            raise ValueError("Usuario ya existe")
        self.users[user.id] = user
        self.save()

    def add_item(self, item: Item) -> None:
        if item.id in self.items:
            raise ValueError("Ítem ya existe")
        self.items[item.id] = item
        self.save()

    def find_items(self, query: str) -> List[Item]:
        q = query.lower()
        results = []
        for it in self.items.values():
            if q in it.title.lower() or q in it.item_type().lower():
                results.append(it)
            else:
                # campos específicos
                if isinstance(it, Book) and (q in it.author.lower() if it.author else False):
                    results.append(it)
        return results

    def find_users(self, query: str) -> List[User]:
        q = query.lower()
        return [u for u in self.users.values() if q in u.name.lower() or q in (u.email or "").lower() or q == u.id.lower()]

    def borrow_item(self, item_id: str, user_id: str) -> bool:
        if item_id not in self.items:
            raise ValueError("Ítem no encontrado")
        if user_id not in self.users:
            raise ValueError("Usuario no encontrado")
        item = self.items[item_id]
        user = self.users[user_id]
        if not item.available:
            return False
        ok = item.borrow(user_id)
        if ok:
            user.borrowed_items.append(item_id)
            self.save()
        return ok

    def return_item(self, item_id: str, user_id: str) -> bool:
        if item_id not in self.items:
            raise ValueError("Ítem no encontrado")
        if user_id not in self.users:
            raise ValueError("Usuario no encontrado")
        item = self.items[item_id]
        user = self.users[user_id]
        if item.available or item.borrower_id != user_id:
            return False
        ok = item.give_back()
        if ok:
            if item_id in user.borrowed_items:
                user.borrowed_items.remove(item_id)
            self.save()
        return ok

    # --- persistencia ---
    def save(self) -> None:
        payload = {
            "items": {iid: it.to_dict() for iid, it in self.items.items()},
            "users": {uid: u.to_dict() for uid, u in self.users.items()}
        }
        with open(DATA_FILE, "w", encoding="utf-8") as f:
            json.dump(payload, f, indent=2, ensure_ascii=False)

    def load(self) -> None:
        if not os.path.exists(DATA_FILE):
            return
        with open(DATA_FILE, "r", encoding="utf-8") as f:
            payload = json.load(f)
        # Cargar users
        self.users = {}
        for uid, ud in payload.get("users", {}).items():
            u = User(uid, ud.get("name", ""), ud.get("email"))
            u.borrowed_items = ud.get("borrowed_items", [])
            self.users[uid] = u
        # Cargar items (reconstruir tipo concreto)
        self.items = {}
        for iid, idata in payload.get("items", {}).items():
            t = idata.get("type")
            if t == "book":
                it = Book(iid, idata.get("title", ""), idata.get("author", ""), idata.get("year", 0), idata.get("isbn"))
            elif t == "magazine":
                it = Magazine(iid, idata.get("title", ""), idata.get("issue", ""), idata.get("year", 0))
            else:
                # genérico fallback
                class GenericItem(Item):
                    def item_type(self): return "generic"
                it = GenericItem(iid, idata.get("title", ""), idata.get("year", 0))
            it.available = idata.get("available", True)
            it.borrower_id = idata.get("borrower_id")
            it.borrow_date = idata.get("borrow_date")
            self.items[iid] = it

    # Utility
    def list_items(self) -> List[Dict]:
        return [it.to_dict() for it in self.items.values()]

    def list_users(self) -> List[Dict]:
        return [u.to_dict() for u in self.users.values()]

# -------------------------
# Interfaz de consola (menú)
# -------------------------

def input_nonempty(prompt: str) -> str:
    while True:
        v = input(prompt).strip()
        if v:
            return v

def main_menu(lib: Library):
    while True:
        print("\n=== Biblioteca POO ===")
        print("1) Registrar usuario")
        print("2) Registrar ítem (libro/revista)")
        print("3) Buscar ítems")
        print("4) Buscar usuarios")
        print("5) Prestar ítem")
        print("6) Devolver ítem")
        print("7) Listar ítems")
        print("8) Listar usuarios")
        print("9) Salir")
        choice = input("Opción: ").strip()
        try:
            if choice == "1":
                uid = input_nonempty("ID usuario: ")
                name = input_nonempty("Nombre: ")
                email = input("Email (opcional): ").strip() or None
                lib.add_user(User(uid, name, email))
                print("Usuario registrado.")
            elif choice == "2":
                itype = input("Tipo (book/magazine): ").strip().lower()
                iid = input_nonempty("ID ítem: ")
                title = input_nonempty("Título: ")
                year = int(input("Año: ").strip() or 0)
                if itype == "book":
                    author = input_nonempty("Autor: ")
                    isbn = input("ISBN (opcional): ").strip() or None
                    lib.add_item(Book(iid, title, author, year, isbn))
                else:
                    issue = input("Número/Edición: ").strip() or "n/a"
                    lib.add_item(Magazine(iid, title, issue, year))
                print("Ítem registrado.")
            elif choice == "3":
                q = input_nonempty("Buscar (título/autor/tipo): ")
                res = lib.find_items(q)
                if not res:
                    print("No hay resultados.")
                else:
                    for it in res:
                        print(json.dumps(it.to_dict(), ensure_ascii=False, indent=2))
            elif choice == "4":
                q = input_nonempty("Buscar usuario (nombre/id/email): ")
                res = lib.find_users(q)
                if not res:
                    print("No hay resultados.")
                else:
                    for u in res:
                        print(json.dumps(u.to_dict(), ensure_ascii=False, indent=2))
            elif choice == "5":
                iid = input_nonempty("ID ítem a prestar: ")
                uid = input_nonempty("ID usuario: ")
                ok = lib.borrow_item(iid, uid)
                if ok:
                    print("Préstamo realizado.")
                else:
                    print("No fue posible prestar (puede que no esté disponible).")
            elif choice == "6":
                iid = input_nonempty("ID ítem a devolver: ")
                uid = input_nonempty("ID usuario que devuelve: ")
                ok = lib.return_item(iid, uid)
                if ok:
                    print("Devolución registrada.")
                else:
                    print("No se pudo procesar la devolución.")
            elif choice == "7":
                for it in lib.list_items():
                    print(json.dumps(it, ensure_ascii=False, indent=2))
            elif choice == "8":
                for u in lib.list_users():
                    print(json.dumps(u, ensure_ascii=False, indent=2))
            elif choice == "9":
                print("Saliendo.")
                break
            else:
                print("Opción inválida.")
        except Exception as e:
            print("Error:", e)

if __name__ == "__main__":
    library = Library()
    print("Datos cargados. Ítems:", len(library.items), " Usuarios:", len(library.users))
    main_menu(library)
Qué hace (resumen):'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gaelflores.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Práctica 2","item":"https://gaelflores.github.io/posts/practica_2/"},{"@type":"ListItem","position":3,"name":"Práctica 2: Programación Orientada a Objetos","item":"https://gaelflores.github.io/posts/practica_2/codigo_python_poo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Práctica 2: Programación Orientada a Objetos","name":"Práctica 2: Programación Orientada a Objetos","description":"Codigo Migrado en python(POO) Guarda este archivo en la raíz del proyecto o en una carpeta biblioteca_python/. Es autocontenido y usa JSON (data.json) para persistencia.\n#!/usr/bin/env python3 # biblioteca_poo.py # Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON # Requisitos: Python 3.7+ import json from datetime import datetime from typing import List, Dict, Optional from abc import ABC, abstractmethod import os DATA_FILE = \u0026#34;biblioteca_data.json\u0026#34; # ------------------------- # Modelos (POO) # ------------------------- class Item(ABC): \u0026#34;\u0026#34;\u0026#34;Clase abstracta para ítems de la biblioteca.\u0026#34;\u0026#34;\u0026#34; def __init__(self, item_id: str, title: str, year: int): self._id = item_id # encapsulado (protected) self.title = title self.year = year self.available = True self.borrower_id: Optional[str] = None self.borrow_date: Optional[str] = None @property def id(self): return self._id @abstractmethod def item_type(self) -\u0026gt; str: pass def to_dict(self) -\u0026gt; Dict: return { \u0026#34;id\u0026#34;: self._id, \u0026#34;title\u0026#34;: self.title, \u0026#34;year\u0026#34;: self.year, \u0026#34;type\u0026#34;: self.item_type(), \u0026#34;available\u0026#34;: self.available, \u0026#34;borrower_id\u0026#34;: self.borrower_id, \u0026#34;borrow_date\u0026#34;: self.borrow_date } def borrow(self, user_id: str) -\u0026gt; bool: if not self.available: return False self.available = False self.borrower_id = user_id self.borrow_date = datetime.utcnow().isoformat() return True def give_back(self) -\u0026gt; bool: if self.available: return False self.available = True self.borrower_id = None self.borrow_date = None return True class Book(Item): def __init__(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] = None): super().__init__(item_id, title, year) self.author = author self.isbn = isbn def item_type(self) -\u0026gt; str: return \u0026#34;book\u0026#34; def to_dict(self) -\u0026gt; Dict: d = super().to_dict() d.update({\u0026#34;author\u0026#34;: self.author, \u0026#34;isbn\u0026#34;: self.isbn}) return d class Magazine(Item): def __init__(self, item_id: str, title: str, issue: str, year: int): super().__init__(item_id, title, year) self.issue = issue def item_type(self) -\u0026gt; str: return \u0026#34;magazine\u0026#34; def to_dict(self) -\u0026gt; Dict: d = super().to_dict() d.update({\u0026#34;issue\u0026#34;: self.issue}) return d class User: def __init__(self, user_id: str, name: str, email: Optional[str] = None): self._id = user_id # encapsulación self.name = name self.email = email self.borrowed_items: List[str] = [] # lista de ids @property def id(self): return self._id def to_dict(self) -\u0026gt; Dict: return { \u0026#34;id\u0026#34;: self._id, \u0026#34;name\u0026#34;: self.name, \u0026#34;email\u0026#34;: self.email, \u0026#34;borrowed_items\u0026#34;: self.borrowed_items } # ------------------------- # Biblioteca (gestor) # ------------------------- class Library: def __init__(self): self.items: Dict[str, Item] = {} self.users: Dict[str, User] = {} self.load() # --- CRUD / operaciones --- def add_user(self, user: User) -\u0026gt; None: if user.id in self.users: raise ValueError(\u0026#34;Usuario ya existe\u0026#34;) self.users[user.id] = user self.save() def add_item(self, item: Item) -\u0026gt; None: if item.id in self.items: raise ValueError(\u0026#34;Ítem ya existe\u0026#34;) self.items[item.id] = item self.save() def find_items(self, query: str) -\u0026gt; List[Item]: q = query.lower() results = [] for it in self.items.values(): if q in it.title.lower() or q in it.item_type().lower(): results.append(it) else: # campos específicos if isinstance(it, Book) and (q in it.author.lower() if it.author else False): results.append(it) return results def find_users(self, query: str) -\u0026gt; List[User]: q = query.lower() return [u for u in self.users.values() if q in u.name.lower() or q in (u.email or \u0026#34;\u0026#34;).lower() or q == u.id.lower()] def borrow_item(self, item_id: str, user_id: str) -\u0026gt; bool: if item_id not in self.items: raise ValueError(\u0026#34;Ítem no encontrado\u0026#34;) if user_id not in self.users: raise ValueError(\u0026#34;Usuario no encontrado\u0026#34;) item = self.items[item_id] user = self.users[user_id] if not item.available: return False ok = item.borrow(user_id) if ok: user.borrowed_items.append(item_id) self.save() return ok def return_item(self, item_id: str, user_id: str) -\u0026gt; bool: if item_id not in self.items: raise ValueError(\u0026#34;Ítem no encontrado\u0026#34;) if user_id not in self.users: raise ValueError(\u0026#34;Usuario no encontrado\u0026#34;) item = self.items[item_id] user = self.users[user_id] if item.available or item.borrower_id != user_id: return False ok = item.give_back() if ok: if item_id in user.borrowed_items: user.borrowed_items.remove(item_id) self.save() return ok # --- persistencia --- def save(self) -\u0026gt; None: payload = { \u0026#34;items\u0026#34;: {iid: it.to_dict() for iid, it in self.items.items()}, \u0026#34;users\u0026#34;: {uid: u.to_dict() for uid, u in self.users.items()} } with open(DATA_FILE, \u0026#34;w\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as f: json.dump(payload, f, indent=2, ensure_ascii=False) def load(self) -\u0026gt; None: if not os.path.exists(DATA_FILE): return with open(DATA_FILE, \u0026#34;r\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) as f: payload = json.load(f) # Cargar users self.users = {} for uid, ud in payload.get(\u0026#34;users\u0026#34;, {}).items(): u = User(uid, ud.get(\u0026#34;name\u0026#34;, \u0026#34;\u0026#34;), ud.get(\u0026#34;email\u0026#34;)) u.borrowed_items = ud.get(\u0026#34;borrowed_items\u0026#34;, []) self.users[uid] = u # Cargar items (reconstruir tipo concreto) self.items = {} for iid, idata in payload.get(\u0026#34;items\u0026#34;, {}).items(): t = idata.get(\u0026#34;type\u0026#34;) if t == \u0026#34;book\u0026#34;: it = Book(iid, idata.get(\u0026#34;title\u0026#34;, \u0026#34;\u0026#34;), idata.get(\u0026#34;author\u0026#34;, \u0026#34;\u0026#34;), idata.get(\u0026#34;year\u0026#34;, 0), idata.get(\u0026#34;isbn\u0026#34;)) elif t == \u0026#34;magazine\u0026#34;: it = Magazine(iid, idata.get(\u0026#34;title\u0026#34;, \u0026#34;\u0026#34;), idata.get(\u0026#34;issue\u0026#34;, \u0026#34;\u0026#34;), idata.get(\u0026#34;year\u0026#34;, 0)) else: # genérico fallback class GenericItem(Item): def item_type(self): return \u0026#34;generic\u0026#34; it = GenericItem(iid, idata.get(\u0026#34;title\u0026#34;, \u0026#34;\u0026#34;), idata.get(\u0026#34;year\u0026#34;, 0)) it.available = idata.get(\u0026#34;available\u0026#34;, True) it.borrower_id = idata.get(\u0026#34;borrower_id\u0026#34;) it.borrow_date = idata.get(\u0026#34;borrow_date\u0026#34;) self.items[iid] = it # Utility def list_items(self) -\u0026gt; List[Dict]: return [it.to_dict() for it in self.items.values()] def list_users(self) -\u0026gt; List[Dict]: return [u.to_dict() for u in self.users.values()] # ------------------------- # Interfaz de consola (menú) # ------------------------- def input_nonempty(prompt: str) -\u0026gt; str: while True: v = input(prompt).strip() if v: return v def main_menu(lib: Library): while True: print(\u0026#34;\\n=== Biblioteca POO ===\u0026#34;) print(\u0026#34;1) Registrar usuario\u0026#34;) print(\u0026#34;2) Registrar ítem (libro/revista)\u0026#34;) print(\u0026#34;3) Buscar ítems\u0026#34;) print(\u0026#34;4) Buscar usuarios\u0026#34;) print(\u0026#34;5) Prestar ítem\u0026#34;) print(\u0026#34;6) Devolver ítem\u0026#34;) print(\u0026#34;7) Listar ítems\u0026#34;) print(\u0026#34;8) Listar usuarios\u0026#34;) print(\u0026#34;9) Salir\u0026#34;) choice = input(\u0026#34;Opción: \u0026#34;).strip() try: if choice == \u0026#34;1\u0026#34;: uid = input_nonempty(\u0026#34;ID usuario: \u0026#34;) name = input_nonempty(\u0026#34;Nombre: \u0026#34;) email = input(\u0026#34;Email (opcional): \u0026#34;).strip() or None lib.add_user(User(uid, name, email)) print(\u0026#34;Usuario registrado.\u0026#34;) elif choice == \u0026#34;2\u0026#34;: itype = input(\u0026#34;Tipo (book/magazine): \u0026#34;).strip().lower() iid = input_nonempty(\u0026#34;ID ítem: \u0026#34;) title = input_nonempty(\u0026#34;Título: \u0026#34;) year = int(input(\u0026#34;Año: \u0026#34;).strip() or 0) if itype == \u0026#34;book\u0026#34;: author = input_nonempty(\u0026#34;Autor: \u0026#34;) isbn = input(\u0026#34;ISBN (opcional): \u0026#34;).strip() or None lib.add_item(Book(iid, title, author, year, isbn)) else: issue = input(\u0026#34;Número/Edición: \u0026#34;).strip() or \u0026#34;n/a\u0026#34; lib.add_item(Magazine(iid, title, issue, year)) print(\u0026#34;Ítem registrado.\u0026#34;) elif choice == \u0026#34;3\u0026#34;: q = input_nonempty(\u0026#34;Buscar (título/autor/tipo): \u0026#34;) res = lib.find_items(q) if not res: print(\u0026#34;No hay resultados.\u0026#34;) else: for it in res: print(json.dumps(it.to_dict(), ensure_ascii=False, indent=2)) elif choice == \u0026#34;4\u0026#34;: q = input_nonempty(\u0026#34;Buscar usuario (nombre/id/email): \u0026#34;) res = lib.find_users(q) if not res: print(\u0026#34;No hay resultados.\u0026#34;) else: for u in res: print(json.dumps(u.to_dict(), ensure_ascii=False, indent=2)) elif choice == \u0026#34;5\u0026#34;: iid = input_nonempty(\u0026#34;ID ítem a prestar: \u0026#34;) uid = input_nonempty(\u0026#34;ID usuario: \u0026#34;) ok = lib.borrow_item(iid, uid) if ok: print(\u0026#34;Préstamo realizado.\u0026#34;) else: print(\u0026#34;No fue posible prestar (puede que no esté disponible).\u0026#34;) elif choice == \u0026#34;6\u0026#34;: iid = input_nonempty(\u0026#34;ID ítem a devolver: \u0026#34;) uid = input_nonempty(\u0026#34;ID usuario que devuelve: \u0026#34;) ok = lib.return_item(iid, uid) if ok: print(\u0026#34;Devolución registrada.\u0026#34;) else: print(\u0026#34;No se pudo procesar la devolución.\u0026#34;) elif choice == \u0026#34;7\u0026#34;: for it in lib.list_items(): print(json.dumps(it, ensure_ascii=False, indent=2)) elif choice == \u0026#34;8\u0026#34;: for u in lib.list_users(): print(json.dumps(u, ensure_ascii=False, indent=2)) elif choice == \u0026#34;9\u0026#34;: print(\u0026#34;Saliendo.\u0026#34;) break else: print(\u0026#34;Opción inválida.\u0026#34;) except Exception as e: print(\u0026#34;Error:\u0026#34;, e) if __name__ == \u0026#34;__main__\u0026#34;: library = Library() print(\u0026#34;Datos cargados. Ítems:\u0026#34;, len(library.items), \u0026#34; Usuarios:\u0026#34;, len(library.users)) main_menu(library) Qué hace (resumen):\n","keywords":[],"articleBody":"Codigo Migrado en python(POO) Guarda este archivo en la raíz del proyecto o en una carpeta biblioteca_python/. Es autocontenido y usa JSON (data.json) para persistencia.\n#!/usr/bin/env python3 # biblioteca_poo.py # Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON # Requisitos: Python 3.7+ import json from datetime import datetime from typing import List, Dict, Optional from abc import ABC, abstractmethod import os DATA_FILE = \"biblioteca_data.json\" # ------------------------- # Modelos (POO) # ------------------------- class Item(ABC): \"\"\"Clase abstracta para ítems de la biblioteca.\"\"\" def __init__(self, item_id: str, title: str, year: int): self._id = item_id # encapsulado (protected) self.title = title self.year = year self.available = True self.borrower_id: Optional[str] = None self.borrow_date: Optional[str] = None @property def id(self): return self._id @abstractmethod def item_type(self) -\u003e str: pass def to_dict(self) -\u003e Dict: return { \"id\": self._id, \"title\": self.title, \"year\": self.year, \"type\": self.item_type(), \"available\": self.available, \"borrower_id\": self.borrower_id, \"borrow_date\": self.borrow_date } def borrow(self, user_id: str) -\u003e bool: if not self.available: return False self.available = False self.borrower_id = user_id self.borrow_date = datetime.utcnow().isoformat() return True def give_back(self) -\u003e bool: if self.available: return False self.available = True self.borrower_id = None self.borrow_date = None return True class Book(Item): def __init__(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] = None): super().__init__(item_id, title, year) self.author = author self.isbn = isbn def item_type(self) -\u003e str: return \"book\" def to_dict(self) -\u003e Dict: d = super().to_dict() d.update({\"author\": self.author, \"isbn\": self.isbn}) return d class Magazine(Item): def __init__(self, item_id: str, title: str, issue: str, year: int): super().__init__(item_id, title, year) self.issue = issue def item_type(self) -\u003e str: return \"magazine\" def to_dict(self) -\u003e Dict: d = super().to_dict() d.update({\"issue\": self.issue}) return d class User: def __init__(self, user_id: str, name: str, email: Optional[str] = None): self._id = user_id # encapsulación self.name = name self.email = email self.borrowed_items: List[str] = [] # lista de ids @property def id(self): return self._id def to_dict(self) -\u003e Dict: return { \"id\": self._id, \"name\": self.name, \"email\": self.email, \"borrowed_items\": self.borrowed_items } # ------------------------- # Biblioteca (gestor) # ------------------------- class Library: def __init__(self): self.items: Dict[str, Item] = {} self.users: Dict[str, User] = {} self.load() # --- CRUD / operaciones --- def add_user(self, user: User) -\u003e None: if user.id in self.users: raise ValueError(\"Usuario ya existe\") self.users[user.id] = user self.save() def add_item(self, item: Item) -\u003e None: if item.id in self.items: raise ValueError(\"Ítem ya existe\") self.items[item.id] = item self.save() def find_items(self, query: str) -\u003e List[Item]: q = query.lower() results = [] for it in self.items.values(): if q in it.title.lower() or q in it.item_type().lower(): results.append(it) else: # campos específicos if isinstance(it, Book) and (q in it.author.lower() if it.author else False): results.append(it) return results def find_users(self, query: str) -\u003e List[User]: q = query.lower() return [u for u in self.users.values() if q in u.name.lower() or q in (u.email or \"\").lower() or q == u.id.lower()] def borrow_item(self, item_id: str, user_id: str) -\u003e bool: if item_id not in self.items: raise ValueError(\"Ítem no encontrado\") if user_id not in self.users: raise ValueError(\"Usuario no encontrado\") item = self.items[item_id] user = self.users[user_id] if not item.available: return False ok = item.borrow(user_id) if ok: user.borrowed_items.append(item_id) self.save() return ok def return_item(self, item_id: str, user_id: str) -\u003e bool: if item_id not in self.items: raise ValueError(\"Ítem no encontrado\") if user_id not in self.users: raise ValueError(\"Usuario no encontrado\") item = self.items[item_id] user = self.users[user_id] if item.available or item.borrower_id != user_id: return False ok = item.give_back() if ok: if item_id in user.borrowed_items: user.borrowed_items.remove(item_id) self.save() return ok # --- persistencia --- def save(self) -\u003e None: payload = { \"items\": {iid: it.to_dict() for iid, it in self.items.items()}, \"users\": {uid: u.to_dict() for uid, u in self.users.items()} } with open(DATA_FILE, \"w\", encoding=\"utf-8\") as f: json.dump(payload, f, indent=2, ensure_ascii=False) def load(self) -\u003e None: if not os.path.exists(DATA_FILE): return with open(DATA_FILE, \"r\", encoding=\"utf-8\") as f: payload = json.load(f) # Cargar users self.users = {} for uid, ud in payload.get(\"users\", {}).items(): u = User(uid, ud.get(\"name\", \"\"), ud.get(\"email\")) u.borrowed_items = ud.get(\"borrowed_items\", []) self.users[uid] = u # Cargar items (reconstruir tipo concreto) self.items = {} for iid, idata in payload.get(\"items\", {}).items(): t = idata.get(\"type\") if t == \"book\": it = Book(iid, idata.get(\"title\", \"\"), idata.get(\"author\", \"\"), idata.get(\"year\", 0), idata.get(\"isbn\")) elif t == \"magazine\": it = Magazine(iid, idata.get(\"title\", \"\"), idata.get(\"issue\", \"\"), idata.get(\"year\", 0)) else: # genérico fallback class GenericItem(Item): def item_type(self): return \"generic\" it = GenericItem(iid, idata.get(\"title\", \"\"), idata.get(\"year\", 0)) it.available = idata.get(\"available\", True) it.borrower_id = idata.get(\"borrower_id\") it.borrow_date = idata.get(\"borrow_date\") self.items[iid] = it # Utility def list_items(self) -\u003e List[Dict]: return [it.to_dict() for it in self.items.values()] def list_users(self) -\u003e List[Dict]: return [u.to_dict() for u in self.users.values()] # ------------------------- # Interfaz de consola (menú) # ------------------------- def input_nonempty(prompt: str) -\u003e str: while True: v = input(prompt).strip() if v: return v def main_menu(lib: Library): while True: print(\"\\n=== Biblioteca POO ===\") print(\"1) Registrar usuario\") print(\"2) Registrar ítem (libro/revista)\") print(\"3) Buscar ítems\") print(\"4) Buscar usuarios\") print(\"5) Prestar ítem\") print(\"6) Devolver ítem\") print(\"7) Listar ítems\") print(\"8) Listar usuarios\") print(\"9) Salir\") choice = input(\"Opción: \").strip() try: if choice == \"1\": uid = input_nonempty(\"ID usuario: \") name = input_nonempty(\"Nombre: \") email = input(\"Email (opcional): \").strip() or None lib.add_user(User(uid, name, email)) print(\"Usuario registrado.\") elif choice == \"2\": itype = input(\"Tipo (book/magazine): \").strip().lower() iid = input_nonempty(\"ID ítem: \") title = input_nonempty(\"Título: \") year = int(input(\"Año: \").strip() or 0) if itype == \"book\": author = input_nonempty(\"Autor: \") isbn = input(\"ISBN (opcional): \").strip() or None lib.add_item(Book(iid, title, author, year, isbn)) else: issue = input(\"Número/Edición: \").strip() or \"n/a\" lib.add_item(Magazine(iid, title, issue, year)) print(\"Ítem registrado.\") elif choice == \"3\": q = input_nonempty(\"Buscar (título/autor/tipo): \") res = lib.find_items(q) if not res: print(\"No hay resultados.\") else: for it in res: print(json.dumps(it.to_dict(), ensure_ascii=False, indent=2)) elif choice == \"4\": q = input_nonempty(\"Buscar usuario (nombre/id/email): \") res = lib.find_users(q) if not res: print(\"No hay resultados.\") else: for u in res: print(json.dumps(u.to_dict(), ensure_ascii=False, indent=2)) elif choice == \"5\": iid = input_nonempty(\"ID ítem a prestar: \") uid = input_nonempty(\"ID usuario: \") ok = lib.borrow_item(iid, uid) if ok: print(\"Préstamo realizado.\") else: print(\"No fue posible prestar (puede que no esté disponible).\") elif choice == \"6\": iid = input_nonempty(\"ID ítem a devolver: \") uid = input_nonempty(\"ID usuario que devuelve: \") ok = lib.return_item(iid, uid) if ok: print(\"Devolución registrada.\") else: print(\"No se pudo procesar la devolución.\") elif choice == \"7\": for it in lib.list_items(): print(json.dumps(it, ensure_ascii=False, indent=2)) elif choice == \"8\": for u in lib.list_users(): print(json.dumps(u, ensure_ascii=False, indent=2)) elif choice == \"9\": print(\"Saliendo.\") break else: print(\"Opción inválida.\") except Exception as e: print(\"Error:\", e) if __name__ == \"__main__\": library = Library() print(\"Datos cargados. Ítems:\", len(library.items), \" Usuarios:\", len(library.users)) main_menu(library) Qué hace (resumen):\nItem es abstracto, con Book y Magazine como subclases (herencia + polimorfismo). Encapsulamiento: atributos _id privados/protegidos, propiedades públicas para acceder. Abstracción: Item oculta detalles concretos a la lógica de la Library. Polimorfismo: item_type() y to_dict() con comportamiento según la subclase. Persistencia: biblioteca_data.json guarda items y users. Menú: permite registrar usuarios/ítems, prestar, devolver, buscar y listar. ","wordCount":"1105","inLanguage":"en","datePublished":"2025-11-14T00:00:00Z","dateModified":"2025-11-14T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://gaelflores.github.io/posts/practica_2/codigo_python_poo/"},"publisher":{"@type":"Organization","name":"PortafolioPP2025","logo":{"@type":"ImageObject","url":"https://gaelflores.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://gaelflores.github.io/ accesskey=h title="PortafolioPP2025 (Alt + H)">PortafolioPP2025</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Práctica 2: Programación Orientada a Objetos</h1><div class=post-meta><span title='2025-11-14 00:00:00 +0000 UTC'>November 14, 2025</span></div></header><div class=post-content><h1 id=codigo-migrado-en-pythonpoo>Codigo Migrado en python(POO)<a hidden class=anchor aria-hidden=true href=#codigo-migrado-en-pythonpoo>#</a></h1><p>Guarda este archivo en la raíz del proyecto o en una carpeta <code>biblioteca_python/</code>. Es autocontenido y usa JSON (<code>data.json</code>) para persistencia.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#75715e># biblioteca_poo.py</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Implementación POO de una Biblioteca (préstamos, usuarios, ítems) con persistencia JSON</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Requisitos: Python 3.7+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List, Dict, Optional
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> abc <span style=color:#f92672>import</span> ABC, abstractmethod
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DATA_FILE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;biblioteca_data.json&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Modelos (POO)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Item</span>(ABC):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;Clase abstracta para ítems de la biblioteca.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, item_id: str, title: str, year: int):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_id <span style=color:#f92672>=</span> item_id            <span style=color:#75715e># encapsulado (protected)</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>title <span style=color:#f92672>=</span> title
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>year <span style=color:#f92672>=</span> year
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>available <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrower_id: Optional[str] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrow_date: Optional[str] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>id</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_id
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>item_type</span>(self) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_dict</span>(self) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: self<span style=color:#f92672>.</span>_id,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;title&#34;</span>: self<span style=color:#f92672>.</span>title,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;year&#34;</span>: self<span style=color:#f92672>.</span>year,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;type&#34;</span>: self<span style=color:#f92672>.</span>item_type(),
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;available&#34;</span>: self<span style=color:#f92672>.</span>available,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;borrower_id&#34;</span>: self<span style=color:#f92672>.</span>borrower_id,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;borrow_date&#34;</span>: self<span style=color:#f92672>.</span>borrow_date
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>borrow</span>(self, user_id: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>available:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>available <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrower_id <span style=color:#f92672>=</span> user_id
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrow_date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>utcnow()<span style=color:#f92672>.</span>isoformat()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>give_back</span>(self) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>available:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>available <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrower_id <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrow_date <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Book</span>(Item):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, item_id: str, title: str, author: str, year: int, isbn: Optional[str] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span><span style=color:#a6e22e>__init__</span>(item_id, title, year)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>author <span style=color:#f92672>=</span> author
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>isbn <span style=color:#f92672>=</span> isbn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>item_type</span>(self) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;book&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_dict</span>(self) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> super()<span style=color:#f92672>.</span>to_dict()
</span></span><span style=display:flex><span>        d<span style=color:#f92672>.</span>update({<span style=color:#e6db74>&#34;author&#34;</span>: self<span style=color:#f92672>.</span>author, <span style=color:#e6db74>&#34;isbn&#34;</span>: self<span style=color:#f92672>.</span>isbn})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Magazine</span>(Item):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, item_id: str, title: str, issue: str, year: int):
</span></span><span style=display:flex><span>        super()<span style=color:#f92672>.</span><span style=color:#a6e22e>__init__</span>(item_id, title, year)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>issue <span style=color:#f92672>=</span> issue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>item_type</span>(self) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;magazine&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_dict</span>(self) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        d <span style=color:#f92672>=</span> super()<span style=color:#f92672>.</span>to_dict()
</span></span><span style=display:flex><span>        d<span style=color:#f92672>.</span>update({<span style=color:#e6db74>&#34;issue&#34;</span>: self<span style=color:#f92672>.</span>issue})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>User</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self, user_id: str, name: str, email: Optional[str] <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_id <span style=color:#f92672>=</span> user_id     <span style=color:#75715e># encapsulación</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>name <span style=color:#f92672>=</span> name
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>email <span style=color:#f92672>=</span> email
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>borrowed_items: List[str] <span style=color:#f92672>=</span> []  <span style=color:#75715e># lista de ids</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@property</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>id</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>_id
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>to_dict</span>(self) <span style=color:#f92672>-&gt;</span> Dict:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;id&#34;</span>: self<span style=color:#f92672>.</span>_id,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span>: self<span style=color:#f92672>.</span>name,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;email&#34;</span>: self<span style=color:#f92672>.</span>email,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;borrowed_items&#34;</span>: self<span style=color:#f92672>.</span>borrowed_items
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Biblioteca (gestor)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Library</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__init__</span>(self):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>items: Dict[str, Item] <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>users: Dict[str, User] <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>load()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># --- CRUD / operaciones ---</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_user</span>(self, user: User) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> user<span style=color:#f92672>.</span>id <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Usuario ya existe&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>users[user<span style=color:#f92672>.</span>id] <span style=color:#f92672>=</span> user
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>save()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_item</span>(self, item: Item) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> item<span style=color:#f92672>.</span>id <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Ítem ya existe&#34;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>items[item<span style=color:#f92672>.</span>id] <span style=color:#f92672>=</span> item
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>save()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_items</span>(self, query: str) <span style=color:#f92672>-&gt;</span> List[Item]:
</span></span><span style=display:flex><span>        q <span style=color:#f92672>=</span> query<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>        results <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> it <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items<span style=color:#f92672>.</span>values():
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> q <span style=color:#f92672>in</span> it<span style=color:#f92672>.</span>title<span style=color:#f92672>.</span>lower() <span style=color:#f92672>or</span> q <span style=color:#f92672>in</span> it<span style=color:#f92672>.</span>item_type()<span style=color:#f92672>.</span>lower():
</span></span><span style=display:flex><span>                results<span style=color:#f92672>.</span>append(it)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#75715e># campos específicos</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> isinstance(it, Book) <span style=color:#f92672>and</span> (q <span style=color:#f92672>in</span> it<span style=color:#f92672>.</span>author<span style=color:#f92672>.</span>lower() <span style=color:#66d9ef>if</span> it<span style=color:#f92672>.</span>author <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>                    results<span style=color:#f92672>.</span>append(it)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> results
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_users</span>(self, query: str) <span style=color:#f92672>-&gt;</span> List[User]:
</span></span><span style=display:flex><span>        q <span style=color:#f92672>=</span> query<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [u <span style=color:#66d9ef>for</span> u <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users<span style=color:#f92672>.</span>values() <span style=color:#66d9ef>if</span> q <span style=color:#f92672>in</span> u<span style=color:#f92672>.</span>name<span style=color:#f92672>.</span>lower() <span style=color:#f92672>or</span> q <span style=color:#f92672>in</span> (u<span style=color:#f92672>.</span>email <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;&#34;</span>)<span style=color:#f92672>.</span>lower() <span style=color:#f92672>or</span> q <span style=color:#f92672>==</span> u<span style=color:#f92672>.</span>id<span style=color:#f92672>.</span>lower()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>borrow_item</span>(self, item_id: str, user_id: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> item_id <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Ítem no encontrado&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> user_id <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Usuario no encontrado&#34;</span>)
</span></span><span style=display:flex><span>        item <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>items[item_id]
</span></span><span style=display:flex><span>        user <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>users[user_id]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> item<span style=color:#f92672>.</span>available:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        ok <span style=color:#f92672>=</span> item<span style=color:#f92672>.</span>borrow(user_id)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ok:
</span></span><span style=display:flex><span>            user<span style=color:#f92672>.</span>borrowed_items<span style=color:#f92672>.</span>append(item_id)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>save()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ok
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>return_item</span>(self, item_id: str, user_id: str) <span style=color:#f92672>-&gt;</span> bool:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> item_id <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Ítem no encontrado&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> user_id <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Usuario no encontrado&#34;</span>)
</span></span><span style=display:flex><span>        item <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>items[item_id]
</span></span><span style=display:flex><span>        user <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>users[user_id]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> item<span style=color:#f92672>.</span>available <span style=color:#f92672>or</span> item<span style=color:#f92672>.</span>borrower_id <span style=color:#f92672>!=</span> user_id:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>        ok <span style=color:#f92672>=</span> item<span style=color:#f92672>.</span>give_back()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ok:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> item_id <span style=color:#f92672>in</span> user<span style=color:#f92672>.</span>borrowed_items:
</span></span><span style=display:flex><span>                user<span style=color:#f92672>.</span>borrowed_items<span style=color:#f92672>.</span>remove(item_id)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>save()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ok
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># --- persistencia ---</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>save</span>(self) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        payload <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;items&#34;</span>: {iid: it<span style=color:#f92672>.</span>to_dict() <span style=color:#66d9ef>for</span> iid, it <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items<span style=color:#f92672>.</span>items()},
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;users&#34;</span>: {uid: u<span style=color:#f92672>.</span>to_dict() <span style=color:#66d9ef>for</span> uid, u <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users<span style=color:#f92672>.</span>items()}
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(DATA_FILE, <span style=color:#e6db74>&#34;w&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            json<span style=color:#f92672>.</span>dump(payload, f, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, ensure_ascii<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load</span>(self) <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(DATA_FILE):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(DATA_FILE, <span style=color:#e6db74>&#34;r&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;utf-8&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            payload <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(f)
</span></span><span style=display:flex><span>        <span style=color:#75715e># Cargar users</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>users <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> uid, ud <span style=color:#f92672>in</span> payload<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;users&#34;</span>, {})<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>            u <span style=color:#f92672>=</span> User(uid, ud<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), ud<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;email&#34;</span>))
</span></span><span style=display:flex><span>            u<span style=color:#f92672>.</span>borrowed_items <span style=color:#f92672>=</span> ud<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;borrowed_items&#34;</span>, [])
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>users[uid] <span style=color:#f92672>=</span> u
</span></span><span style=display:flex><span>        <span style=color:#75715e># Cargar items (reconstruir tipo concreto)</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>items <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> iid, idata <span style=color:#f92672>in</span> payload<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;items&#34;</span>, {})<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>            t <span style=color:#f92672>=</span> idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;type&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;book&#34;</span>:
</span></span><span style=display:flex><span>                it <span style=color:#f92672>=</span> Book(iid, idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;title&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;author&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;year&#34;</span>, <span style=color:#ae81ff>0</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;isbn&#34;</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;magazine&#34;</span>:
</span></span><span style=display:flex><span>                it <span style=color:#f92672>=</span> Magazine(iid, idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;title&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;issue&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;year&#34;</span>, <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#75715e># genérico fallback</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GenericItem</span>(Item):
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>item_type</span>(self): <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;generic&#34;</span>
</span></span><span style=display:flex><span>                it <span style=color:#f92672>=</span> GenericItem(iid, idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;title&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>), idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;year&#34;</span>, <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>            it<span style=color:#f92672>.</span>available <span style=color:#f92672>=</span> idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;available&#34;</span>, <span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>            it<span style=color:#f92672>.</span>borrower_id <span style=color:#f92672>=</span> idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;borrower_id&#34;</span>)
</span></span><span style=display:flex><span>            it<span style=color:#f92672>.</span>borrow_date <span style=color:#f92672>=</span> idata<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;borrow_date&#34;</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>items[iid] <span style=color:#f92672>=</span> it
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Utility</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_items</span>(self) <span style=color:#f92672>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [it<span style=color:#f92672>.</span>to_dict() <span style=color:#66d9ef>for</span> it <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>items<span style=color:#f92672>.</span>values()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>list_users</span>(self) <span style=color:#f92672>-&gt;</span> List[Dict]:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> [u<span style=color:#f92672>.</span>to_dict() <span style=color:#66d9ef>for</span> u <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>users<span style=color:#f92672>.</span>values()]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Interfaz de consola (menú)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># -------------------------</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>input_nonempty</span>(prompt: str) <span style=color:#f92672>-&gt;</span> str:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        v <span style=color:#f92672>=</span> input(prompt)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> v:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> v
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main_menu</span>(lib: Library):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>=== Biblioteca POO ===&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;1) Registrar usuario&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;2) Registrar ítem (libro/revista)&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;3) Buscar ítems&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;4) Buscar usuarios&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;5) Prestar ítem&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;6) Devolver ítem&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;7) Listar ítems&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;8) Listar usuarios&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;9) Salir&#34;</span>)
</span></span><span style=display:flex><span>        choice <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Opción: &#34;</span>)<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;1&#34;</span>:
</span></span><span style=display:flex><span>                uid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID usuario: &#34;</span>)
</span></span><span style=display:flex><span>                name <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;Nombre: &#34;</span>)
</span></span><span style=display:flex><span>                email <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Email (opcional): &#34;</span>)<span style=color:#f92672>.</span>strip() <span style=color:#f92672>or</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>                lib<span style=color:#f92672>.</span>add_user(User(uid, name, email))
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Usuario registrado.&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;2&#34;</span>:
</span></span><span style=display:flex><span>                itype <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Tipo (book/magazine): &#34;</span>)<span style=color:#f92672>.</span>strip()<span style=color:#f92672>.</span>lower()
</span></span><span style=display:flex><span>                iid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID ítem: &#34;</span>)
</span></span><span style=display:flex><span>                title <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;Título: &#34;</span>)
</span></span><span style=display:flex><span>                year <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;Año: &#34;</span>)<span style=color:#f92672>.</span>strip() <span style=color:#f92672>or</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> itype <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;book&#34;</span>:
</span></span><span style=display:flex><span>                    author <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;Autor: &#34;</span>)
</span></span><span style=display:flex><span>                    isbn <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;ISBN (opcional): &#34;</span>)<span style=color:#f92672>.</span>strip() <span style=color:#f92672>or</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>                    lib<span style=color:#f92672>.</span>add_item(Book(iid, title, author, year, isbn))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    issue <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;Número/Edición: &#34;</span>)<span style=color:#f92672>.</span>strip() <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;n/a&#34;</span>
</span></span><span style=display:flex><span>                    lib<span style=color:#f92672>.</span>add_item(Magazine(iid, title, issue, year))
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Ítem registrado.&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;3&#34;</span>:
</span></span><span style=display:flex><span>                q <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;Buscar (título/autor/tipo): &#34;</span>)
</span></span><span style=display:flex><span>                res <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>find_items(q)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> res:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;No hay resultados.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> it <span style=color:#f92672>in</span> res:
</span></span><span style=display:flex><span>                        print(json<span style=color:#f92672>.</span>dumps(it<span style=color:#f92672>.</span>to_dict(), ensure_ascii<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;4&#34;</span>:
</span></span><span style=display:flex><span>                q <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;Buscar usuario (nombre/id/email): &#34;</span>)
</span></span><span style=display:flex><span>                res <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>find_users(q)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> res:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;No hay resultados.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> u <span style=color:#f92672>in</span> res:
</span></span><span style=display:flex><span>                        print(json<span style=color:#f92672>.</span>dumps(u<span style=color:#f92672>.</span>to_dict(), ensure_ascii<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;5&#34;</span>:
</span></span><span style=display:flex><span>                iid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID ítem a prestar: &#34;</span>)
</span></span><span style=display:flex><span>                uid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID usuario: &#34;</span>)
</span></span><span style=display:flex><span>                ok <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>borrow_item(iid, uid)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> ok:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;Préstamo realizado.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;No fue posible prestar (puede que no esté disponible).&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;6&#34;</span>:
</span></span><span style=display:flex><span>                iid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID ítem a devolver: &#34;</span>)
</span></span><span style=display:flex><span>                uid <span style=color:#f92672>=</span> input_nonempty(<span style=color:#e6db74>&#34;ID usuario que devuelve: &#34;</span>)
</span></span><span style=display:flex><span>                ok <span style=color:#f92672>=</span> lib<span style=color:#f92672>.</span>return_item(iid, uid)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> ok:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;Devolución registrada.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                    print(<span style=color:#e6db74>&#34;No se pudo procesar la devolución.&#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;7&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> it <span style=color:#f92672>in</span> lib<span style=color:#f92672>.</span>list_items():
</span></span><span style=display:flex><span>                    print(json<span style=color:#f92672>.</span>dumps(it, ensure_ascii<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;8&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> u <span style=color:#f92672>in</span> lib<span style=color:#f92672>.</span>list_users():
</span></span><span style=display:flex><span>                    print(json<span style=color:#f92672>.</span>dumps(u, ensure_ascii<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> choice <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;9&#34;</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Saliendo.&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;Opción inválida.&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>Exception</span> <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Error:&#34;</span>, e)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    library <span style=color:#f92672>=</span> Library()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Datos cargados. Ítems:&#34;</span>, len(library<span style=color:#f92672>.</span>items), <span style=color:#e6db74>&#34; Usuarios:&#34;</span>, len(library<span style=color:#f92672>.</span>users))
</span></span><span style=display:flex><span>    main_menu(library)
</span></span></code></pre></div><p><strong>Qué hace</strong> (resumen):</p><ul><li><code>Item</code> es abstracto, con <code>Book</code> y <code>Magazine</code> como subclases (herencia + polimorfismo).</li><li>Encapsulamiento: atributos <code>_id</code> privados/protegidos, propiedades públicas para acceder.</li><li>Abstracción: <code>Item</code> oculta detalles concretos a la lógica de la <code>Library</code>.</li><li>Polimorfismo: <code>item_type()</code> y <code>to_dict()</code> con comportamiento según la subclase.</li><li>Persistencia: <code>biblioteca_data.json</code> guarda <code>items</code> y <code>users</code>.</li><li>Menú: permite registrar usuarios/ítems, prestar, devolver, buscar y listar.</li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://gaelflores.github.io/>PortafolioPP2025</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>